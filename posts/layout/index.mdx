---
title: Layout mode 與 display 屬性
excerpt: 如果你曾深入研究過 CSS 規範，那你可能看過標題上這幾個名詞，這些名詞的意思與之間的關係雖然複雜，但理解後能幫助你更了解 CSS 背後的運作機制。
publish_date: 2022/1/9
category: mechanism
---

如果你曾深入研究過 CSS 規範，那你可能看過標題上這幾個名詞，這些名詞的意思與之間的關係雖然複雜，但理解後能幫助你更了解 CSS 背後的運作機制。

在這篇文章裡，我會先介紹 layout mode, formatting context 各自的含義，再來會介紹 display 屬性，看看 display 屬性是如何影響 layout 的。

## Layout Mode

layout mode，有時又稱 layout，是一組演算法，定義了其下 element 的排列方式及行為，像是在 flexible box layout 裡，elements 可以依水平或垂直方向排列，並且可以用 `justify-content` 或 `align-items` 等屬性控制 element 實際該在的位置。

### Layout mode module

layout mode module 這個詞存在在 CSS 規範中，裡頭包括 positioned layout module, flexible box layout module, grid layout module 等，這些 module 在規範裡各自都定義了一組新的 layout 和帶來的新內容，再舉 flexible box layout module 為例，它就擴充了 `display` 屬性的值: `flex`, `inline-flex` 並且添加數個關鍵字，像是 flex container, flex item, flex formatting context 等。

現在，總共有 7 種不同的 layout mode，我們底下來分別介紹:

### Flow Layout

flow layout 又稱 normal flow，是預設的 layout，若你沒有特別定義 layout，那麼整份網頁就會按照 flow layout 的方式進行排列。

在 flow layout 裡 block level 的 element 會參與到 block formatting context，而 inline level 的 element 則會參與到 inline formatting context，且其下的 element 都必須參與一種 formatting context。在 flow layout 裡又有 2 個子 layout: block formatting context 裡使用 block layout，inline formatting context 裡使用 inline layout。

block layout 與 inline layout 就是我們熟知的 block 與 inline 的排列方式，在 block layout 裡，每個 element 自成一行，彼此可以透過 margin 隔開；在 inline layout 裡，element 沒有 `margin-top`, `margin-bottom` , `width`, `height`，elements 從左到右排列。

### Table Layout

table layout 下的 elements 以 table 的方式進行排列。

### Float Layout

float layout 下的 elements 以 float 的方式存在於畫面中。

### Positioned Layout

依照 position 的 value 以及 `top`, `bottom`, `left`, `right` 等屬性對 element 進行定位。

### Multi-column layout

multi-column layout 下的 elements 可以像 newspaper 或書籍那樣排列。

### Flexible box layout

flexible box layout layout 下的 elements 能透過 flex 屬性進行複雜排列。

### Grid layout

grid layout 下的 element 能透過 grid 屬性進行複雜二維排列。

在這些不同的 layout 中還定義了許多細則，像是在 flexible box layout 定義了 flex item 不會發生 margin collapse。

而 layout 與 layout 彼此之間也存在著一些互動規則，像是 positioned layout element 預設會渲染在其他種 layout element 的「上方」(z 軸)。

因為這些規則大量且繁雜，且這篇文章是想給大家一個 overview，因此這裡就不多加說明。

## Formatting Context

在上個段落中，我們有提到 block formatting context, inline formatting context, 與 flex formatting context，除了這些之外，還有 grid formatting context 等。

CSS 規範中並沒有給 formatting context 一個具體的描述，我是將 formatting context 理解成 group 的概念，假設在 flow layout 下，html tag 創造了一個 block formatting context，那麼現在在這整份 document 裡就存在了一個 id 為 123 (假設) 的 block formatting context，你可以把任何 element 加到這個 id 為 123 的 block formatting context 中，而這些 element 被視為存在在同一個 context 之下。

當然這些 elements 也可以自立門戶，在其下自創新的 block formatting context，那這個 block formatting context 的 id 就會與之前那個 html tag 創的不同。

因此一份 document 裡可以有多種 formatting context ，而每種 formatting context 又可以有多份不同 id 的 context。

不同的 formatting context 裡遵循著不同的 layout mode，像是 block formatting context 遵循 block layout、flex formatting context 遵循 flexible box layout。而 formatting context 與 formatting context 彼此間也存在一些互動規則，像是不同的 block formatting context 彼此間不會發生 margin collapse:

```html {1,3-4}
<div>
  <p>Line 1</p>
  <p>Line 2</p>
  <div class="newBFC">
    <p>Line 3</p>
  </div>
</div>

<style>
  p {
    margin: 20px 0;
  }
</style>

<!--如果 .newBFC 創造了一個新的 block formmating context，那麼 Line 2 與 Line 3 間就不會發生 margin collapse-->
```

更多關於 block formatting context 的產生時機、行為與應用我會另寫一篇文章做介紹。

## display 屬性

既然 layout 都規範在那了，那我們如何使用這些酷炫的 layout 進行排版呢？

那當然是使用 display 屬性了。

當你定義 display 屬性時，會同時產生 outer display style 與 inner display style，outer display style 作用在被標上 display 屬性的那個 element 上，而 inner display style 則作用在那個 element 的 children 上。

不同的 display style 會對應產生不同的行為，底下這張 table 說明當你使用 display 屬性時，背後做了什麼事:

![Display table](https://res.cloudinary.com/dgppby8lr/image/upload/v1641712344/display-table_ykm5qt.png)

從上面這張 table 可以看到，當你寫出 `display: block` 時，你其實是寫出了 `display: block flow`，前面的 `block` 是 outer display style，代表該 element 會是一個 block element，而如我們前面所說，如果他剛好又在 flow layout 下，那麼該 element 就會參與到一個 block formatting context 之中，並按照 block layout 的規則進行排列。後面的 `flow` 是 inner display style，代表該 element 底下的 children 會存在在 flow layout 之中。

我們知道每個 element 都有 display 屬性，因此上面這個過程會持續的遞迴下去，最後每個 element 都會正確的被定位，也就會呈現出一份漂亮的網頁。

下面再舉一個例子，假設我們有下面這樣的 html:

```html
<div>
  <div class="a" style="display: flex">
    <div class="b" style="display: block">123</div>
  </div>
</div>
```

那麼在內部他會被看作這樣:

```
(flow layout)
.a 是 block level element，因為在 flow layout 下，所以參與 block formatting context。並在其下創建 flexible box layout
|
|		(flexible box layout)
|		.b 是 block level element，但因為在 flexible box layout 下，所以改為參與 flex formatting context。並在其下創建 flow layout
```

## 結語

這篇文章以 CSS 規範的語言來解釋 CSS layout 的運作機制，以及 display 屬性究竟是如何改變 layout 的。

雖然這些內容看似不重要，但事實上它正好說明了許多 CSS tricks 與 CSS 異常之處會發生的原因，而這些奇怪之處，我們都將會用本篇的概念在之後的文章做說明。

還記得我第一次了解 layout mode 時，最讓我驚喜的就是原來定義 `display: flex` 的那個 element 自己不是 flexible box layout 的，而是他的 children 才是 flexible box layout 的。

這篇文章從研究到寫完花了很久時間，一來是 CSS 規範對於這些名詞的定義模糊不好懂，再來就是這些知識含量的複雜程度超出我的預期，不過當我們能理解，這些知識都將幫助我們更有自信的寫 CSS!

---

**References**

- [CSS Flow Layout - CSS: Cascading Style Sheets | MDN](https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Flow_Layout)
- [Block and Inline Layout in Normal Flow](https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Flow_Layout/Block_and_Inline_Layout_in_Normal_Flow)
- [Layout mode - CSS: Cascading Style Sheets | MDN](https://developer.mozilla.org/en-US/docs/Web/CSS/Layout_mode)
- [Visual formatting model #normal-flow](https://www.w3.org/TR/CSS2/visuren.html#normal-flow)
- [Box Layout Modes: the display property](https://drafts.csswg.org/css-display/#the-display-properties)
- [Introduction to formatting contexts - CSS: Cascading Style Sheets | MDN](https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Flow_Layout/Intro_to_formatting_contexts)
